<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Profile - SmokeLite</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {package com.swp2.demo.security;


            import com.swp2.demo.service.UserService;
            import org.springframework.beans.factory.annotation.Autowired;
            import org.springframework.context.annotation.Bean;
            import org.springframework.context.annotation.Configuration;
            import org.springframework.security.authentication.dao.DaoAuthenticationProvider;
            import org.springframework.security.config.annotation.web.builders.HttpSecurity;
            import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
            import org.springframework.security.crypto.password.NoOpPasswordEncoder;
            import org.springframework.security.web.SecurityFilterChain;
            import org.springframework.security.web.authentication.AuthenticationSuccessHandler;

            @Configuration
            public class SecurityConfiguration {

                @Bean
                public BCryptPasswordEncoder passwordEncoder(){
                    return new BCryptPasswordEncoder();
                }

                @Bean
                public DaoAuthenticationProvider authenticationProvider(UserService userService){
                    DaoAuthenticationProvider daoAuthenticationProvider = new DaoAuthenticationProvider();
                    daoAuthenticationProvider.setUserDetailsService(userService);
                //     daoAuthenticationProvider.setPasswordEncoder(passwordEncoder());
                    daoAuthenticationProvider.setPasswordEncoder(NoOpPasswordEncoder.getInstance());

                    return daoAuthenticationProvider;
                }

                @Autowired
                private CustomAuthenticationSuccessHandler customAuthenticationSuccessHandler;


                @Bean
                public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
                    http
                    .authorizeHttpRequests(auth -> auth
                .requestMatchers(
                "/",
                "/home",
                "/register/**",
                "/login",
                "/css/**",
                "/images/**",
                "/js/**",
                "/member",
                "/questionnaire",
                "/forgot-password",
                "/reset-password",
                //   "/change-password",
                "/about_us").permitAll()

                .requestMatchers("/admin/**").hasAuthority("Admin")
                .requestMatchers("/questionnaire",
                "/profile"
                ).authenticated()


                .anyRequest().authenticated()
                )
                .formLogin(form -> form
                .loginPage("/login")
                .loginProcessingUrl("/authenticateTheUser")
                .successHandler(customAuthenticationSuccessHandler)
                //  .defaultSuccessUrl("/dashboard", true)
                .permitAll()
                )
                .oauth2Login(oauth2 -> oauth2
                .loginPage("/login")
                .successHandler(customAuthenticationSuccessHandler)
                ) .logout(logout -> logout
                .logoutUrl("/logout")
                .logoutSuccessUrl("/home?home")
                .invalidateHttpSession(true)
                .clearAuthentication(true)
                .permitAll());



                    return http.build();
                }

            }

            background: linear-gradient(to right, #e8f0ff, #f5f9ff);
            font-family: 'Segoe UI', sans-serif;
        }
        .profile-container {
            max-width: 600px;
            margin: 5rem auto;
            background: #fff;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h2 {
            text-align: center;
            color: #004a99;
            margin-bottom: 2rem;
        }
        .profile-item {
            margin-bottom: 1.2rem;
        }
        .label {
            font-weight: bold;
            color: #333;
        }
        .value {
            color: #555;
        }
        a {
            text-decoration: none;
            color: #004a99;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
<div class="profile-container">
    <h2>Your Profile</h2>

    <div class="profile-item">
        <span class="label">Username:</span> <span class="value" th:text="${username}"></span>
    </div>

    <div class="profile-item">
        <span class="label">Email:</span> <span class="value" th:text="${email}"></span>
    </div>

    <div class="profile-item">
        <span class="label">First Name:</span> <span class="value" th:text="${firstName}"></span>
    </div>

    <div class="profile-item">
        <span class="label">Last Name:</span> <span class="value" th:text="${lastName}"></span>
    </div>

    <div class="profile-item">
        <span class="label">Gender:</span> <span class="value" th:text="${gender}"></span>
    </div>

    <div class="profile-item">
        <span class="label">Day of birth:</span> <span class="value" th:text="${dateOfBirth}"></span>
    </div>
    <div class="text-center mt-4">
        <a th:href="@{/dashboard}" class="btn btn-primary">Back to Dashboard</a>
    </div>
    <div class="text-center mt-4">
        <a class="btn btn-primary">Edit</a>
    </div>
</div>
</body>
</html>
